services:
  bootnode:
    build:
      context: .
      args:
        VERSION: ${VERSION:-dev}
    env_file:
      - bootnode.env
    ports:
      - 18101:8080
    volumes:
      - ./.masa-bootnode:/home/masa/.masa
      - ./bootnode.env:/app/.env
    command:
      - --masaDir=/home/masa/.masa
      - --env=hometest
      - --api-enabled
      - --logLevel=debug
    restart: always
    networks:
      - masa_network

  worker:
    build:
      context: .
      args:
        VERSION: ${VERSION:-dev}
    env_file:
      - worker.env
    ports:
      - 18102:8080
    volumes:
      - ./.masa-worker:/home/masa/.masa
      - ./worker.env:/app/.env
    command:
      - --masaDir=/home/masa/.masa
      - --env=hometest
      - --api-enabled
      - --logLevel=debug
      - --bootnodes=/dns4/bootnode/udp/4001/quic-v1/p2p/16Uiu2HAmFDT9XC6Y5PGULHRLUM7Y9JKr6GMy64moKKsBRoyFc5qJ
    restart: always
    networks:
      - masa_network
    depends_on:
      - bootnode

# Remove the named volume since we're using bind mounts

networks:
  masa_network:
    driver: bridge

